<?xml version="1.0"?>
<odoo>
    <data>
        <record id="email_template_report_mismatch" model="mail.template">
            <field name="name">Mismatch Lot/Serial Numbers Received Notification</field>
            <field name="model_id" ref="stock.model_stock_picking"/>
            <field name="email_from">{{ user.email }}</field>
            <field name="subject">Action Required: Mismatch Lot/Serial Numbers Received - {{ object.name or '' }} - {{ object.sale_id.name or '' }}</field>
            <field name="email_to">{{ object.sale_id.user_id.partner_id.email }}</field>
            <field name="partner_to">{{object.sale_id.user_id.partner_id.id if object.sale_id and object.sale_id.user_id else ''}}</field>
            <field name="body_html" type="html">
                <div>
                    <p>Hello,</p>
                    <p>A discrepancy has been identified in the received items. 
                    The lot or serial number on the received goods does not match the expected value. 
                    Please review the details below and advise on the next steps.</p>
                    <br/>
                    <p><b>RMA information</b><br/>
                    - RMA Number: <t t-out="object.name or ''" /><br/>
                    - Customer: <t t-out="object.partner_id.display_name or ''" /><br/>
                    - Sales Order: <t t-out="object.sale_id.name or ''" /></p>
                    <br/>
                    <p><b>Product information</b></p>
                    <t t-foreach="object._get_mismatch_move_lines()" t-as="move">
                        <div>
                            - Product: <t t-out="move.product_id.display_name or ''" /><br/>
                            - Expected Lot/Serial Number(s): <t t-out='", ".join(lot.name for lot in move.expected_lot_ids) or ""' /><br/>
                            - Received Lot/Serial Number(s): <t t-out='", ".join(line.lot_id.name for line in move.move_line_ids if line.lot_id) or ""' /><br/>
                        </div>
                        <br/>
                    </t>
                    <p>Thank you,<br/>
                    <t t-out="user.name or ''" /></p>
                </div>
            </field>
        </record>

        <template id="mail_transfer_layout_ow">
            <html t-att-lang="lang">
            <head>
                <meta http-equiv="Content-Type" content="text/html charset=UTF-8" />
            </head>
            <body style="font-family:Verdana, Arial,sans-serif; color: #454748;">
                <div style="max-width: 900px; width: 100%;">
                    <div style="padding: 0px;">
                        <table role="presentation" cellspacing="0" cellpadding="0" border="0" style="width: 100%; margin-top: 5px;">
                            <tbody>
                                <tr>
                                    <td valign="center" style="white-space:nowrap;">
                                        <div>
                                            <span>
                                                <a t-att-href="record.get_formview_url()" target="_blank"
                                                    style="background-color: #875a7b; text-decoration: none; color: #fff; padding: 8px 16px 8px 16px; border-radius: 5px;">View Transfer</a>
                                                &amp;nbsp;&amp;nbsp;
                                                <strong><t t-out="record.name or ''" /></strong>
                                            </span>
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <td valign="center">
                                        <hr width="100%" style="background-color:rgb(204,204,204);border:medium none;clear:both;display:block;font-size:0px;min-height:1px;line-height:0;margin: 10px 0px;"/>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <!-- CONTENT -->
                    <div t-out="message.body" style="font-size: 13px;"/>
                </div>
            </body>
            </html>
        </template>
    </data>
</odoo>
